<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>影片鎖定寬度/鎖定下載</title>
	<style type="text/css">
		body {
			font-size: 16px;
			padding: 0 20px;
		}

		textarea {
	    padding: 4px 8px 4px 8px;
	    resize: none;
	    caret-color: #00afb8;
	    display: block;
	    color: #292929;
	    margin-bottom: 12px;
		}

		 textarea:focus {
	    border-color: #00afb8;
	    outline: none;
  	}

  	.panel {
  		display: flex;
  	}


		#input, #output {
			width: 100%;
			max-width: 720px;
			height: 100px;
		}

		#output{
			margin-top: 16px;
		}

		.tip {
			color: #ea475b;
			display: none;
		}


		button {
			color: #fff;
			height: 38px;
			font-size: 1rem;
			min-width: 128px;
			display: inline-flex;
	    align-items: center;
	    justify-content: center;
	    border-radius: 4px;
	    padding: 0;
	    white-space: nowrap;
	    cursor: pointer;
	    background-color: #00afb8;
	    border-color: #00afb8;
	    font-weight: 400;
	    text-align: center;
	    vertical-align: middle;
	    user-select: none;
	    border: 1px solid transparent;
	    line-height: 1.5;
	    transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;
	        -webkit-appearance: button;
	    text-transform: none;
	    overflow: visible;
	    box-sizing: border-box;

		}
	</style>
	
</head>
<body>
	<!--
		var x = `<video src="https://auth.vip.104-dev.com.tw/vipapi/release-notes/files/2023/05/26154928/1-1%E5%85%AC%E5%8F%B8%E4%BB%8B%E7%B4%B9.mp4" poster="https://auth.vip.104-dev.com.tw/vipapi/release-notes/files/2023/05/26154931/%E5%85%AC%E5%8F%B8%E4%BB%8B%E7%B4%B9.png" controls="controls"></video>`
		<figure class="wp-block-video"><video controls src="https://media.intro.104dc-staging.com/wp-content/uploads/2023/06/06142857/%E6%9F%A5%E8%A9%A2%E9%85%8D%E5%B0%8D.mp4"></video></figure>
		var html = '<figure class="wp-block-video"><  video controls src="https://media.intro.104dc-staging.com/wp-content/uploads/2023/06/06142857/%E6%9F%A5%E8%A9%A2%E9%85%8D%E5%B0%8D.mp4"></  video></figure>';
	-->
	<header>
		<h2>影片鎖定寬度/鎖定下載</h2>
	</header>
	<div>
		<textarea id="input" placeholder="輸入要轉換的video"></textarea>
	</div>
	<section class="panel">
		<div>
	      <input type="checkbox" id="nodownload" name="nodownload" checked>
	      <label for="scales">video不要出現下載項目</label>
	    </div>
		<div style="padding-left: 16px;">
			<button id="convert">轉換</button>
		</div>
	</section>
	<textarea id="output" placeholder="轉換結果"></textarea>
	<div style="margin-bottom: 16px;">
		<button id="clearOutput">清除輸出</button>
	</div>
	<h2>說明</h2>

	<script>
		var isNil = function(val) {
			return val == null
		};
		
		var extractVideoAttributes = function(html) {
			var regex = /<\s*video([^>]*)>/;
			var match = html.match(regex);

			if (match) {
			  var attributes = match[0];
			  var attributeRegex = /(\S+)\s*=\s*["']?((?:.(?!["']?\s+(?:\S+)=|[>"']))+.)["']?/g;
			  var attributeMatch;
			  var videoAttributes = {
			  	width: '100%'
			  };
			  while ((attributeMatch = attributeRegex.exec(attributes))) {
			    var attributeName = attributeMatch[1];
			    var attributeValue = attributeMatch[2];
			    videoAttributes[attributeName] = attributeValue;
			  }
			  return videoAttributes
			}
		};


		var tools = (function(){
			document.querySelector('#convert').addEventListener('click', function() {

				var output = document.querySelector('#output');
				var input = document.querySelector('#input');
				var checkBox = document.querySelector('#nodownload');

				var inputHtml = input.value;
				var isNodownload = checkBox.checked;
			
				if(!isNil(inputHtml)){
					var regex = /<\s*video[^>]*>(.*?)<\s*\/\s*video\s*>/;
					
					var videoAttributes = extractVideoAttributes(inputHtml);
					var videoElement = document.createElement('video');
					videoAttributes.controls = 'controls';
					if(isNodownload){
						videoAttributes.controlslist = "nodownload";
					}

					for (var attribute in videoAttributes) {
						if (videoAttributes.hasOwnProperty(attribute)) {
    					videoElement.setAttribute(attribute, videoAttributes[attribute]);
  					}
					}

					var replacement = videoElement.outerHTML;
					
					var modifiedHtml = inputHtml.replace(regex, replacement);

					output.value = modifiedHtml;
					
					
				}
			})

			document.querySelector('#clearOutput').addEventListener('click', function(){
				var output = document.querySelector('#output');
				output.value = '';
			})

		})();
	</script>
</body>
</html>
